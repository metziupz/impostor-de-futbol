<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impostor Futbolero</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-main: #0D1117;
            --bg-card: #161B22;
            --border-color: #30363D;
            --accent-primary: #58A6FF;
            --accent-secondary: #1F6FEB;
            --text-primary: #C9D1D9;
            --text-secondary: #8B949E;
            --color-danger: #DA3633;
            --color-danger-hover: #b82a27;
            --color-success: #238636;
            --color-success-hover: #1a6428;
            --color-warning: #f1c40f;
            --font-main: 'Poppins', 'Roboto', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-main);
            background-image: linear-gradient(160deg, var(--bg-main) 0%, #1A222C 100%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="75" cy="75" r="0.5" fill="rgba(255,255,255,0.03)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
            z-index: 1;
        }

        .screen {
            display: none;
            position: relative;
            z-index: 2;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: #ffffff;
            margin: 20px 0 30px 0;
            font-size: 3.5em;
            font-weight: 700;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            filter: drop-shadow(0 0 15px rgba(88, 166, 255, 0.5));
        }

        h1 i {
            color: var(--accent-primary);
        }

        h2, h3 {
            color: #ffffff;
            margin: 20px 0;
            text-align: center;
            font-weight: 500;
        }

        .card {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            padding: 30px;
            margin: 20px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        input, select {
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            width: 100%;
            text-align: center;
            background: var(--bg-main);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            -moz-appearance: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        input[type="text"] {
             text-transform: uppercase;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 10px rgba(88, 166, 255, 0.4);
        }

        button {
            padding: 15px 30px;
            background: var(--accent-primary);
            color: var(--bg-main);
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        button:disabled {
            background: var(--border-color);
            color: var(--text-secondary);
            cursor: not-allowed;
            opacity: 0.7;
        }

        #startGameBtn {
            background: var(--color-success);
            color: white;
        }
        #startGameBtn:hover:not(:disabled) {
            background: var(--color-success-hover);
        }

        .leave-btn {
            background: var(--color-danger) !important;
            color: white !important;
        }
        .leave-btn:hover {
            background: var(--color-danger-hover) !important;
        }

        .lobby-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 40px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        #playerList li {
            background: var(--bg-main);
            margin: 10px 0;
            padding: 15px 20px;
            border-radius: 12px;
            width: 300px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
        }

        #roleInfo, #roomCodeDisplay {
            font-size: 1.5em;
            padding: 25px 40px;
            background: var(--bg-main);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            display: inline-block;
            margin: 20px auto;
            font-weight: 500;
        }

        .kick-btn {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 50%;
            font-size: 14px;
        }
        
        #voting-list {
            list-style: none;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        #voting-list li {
            background: var(--bg-main);
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 15px;
            font-size: 18px;
            cursor: pointer;
            min-width: 200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        #voting-list li:hover {
            border-color: var(--accent-primary);
            transform: translateY(-5px);
        }

        #voting-list li.ejected {
            background: #2d3436;
            text-decoration: line-through;
            pointer-events: none;
            opacity: 0.6;
        }

        .vote-count {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-weight: 700;
            padding: 8px 12px;
            border-radius: 50%;
            margin-left: 15px;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .option-group {
            margin-bottom: 25px;
        }

        .option-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .option-group[disabled] {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .impostor-count-selector button.active, .voting-time-selector button.active {
            background: var(--accent-secondary);
            color: white;
            box-shadow: 0 0 10px rgba(31, 111, 235, 0.5);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input { display: none; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--border-color);
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px; width: 26px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--color-success); }
        input:checked + .slider:before { transform: translateX(26px); }

        .probability-value {
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        .error-modal {
            background: linear-gradient(135deg, var(--color-danger), #B82A27);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(218, 54, 51, 0.4);
        }

        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: var(--border-color);
            outline: none;
            border-radius: 4px;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-primary);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--bg-card);
        }

        input[type=range]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--accent-primary);
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }
        
        #offline-mode-button-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
        }

        .countdown-large {
            font-size: 10em;
            font-weight: 700;
            color: var(--accent-primary);
            margin: 20px 0;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    
    <div id="offline-mode-button-container">
        <button id="offlineModeBtn">MODO PRESENCIAL</button>
    </div>

    <div id="menu-screen" class="screen active">
        <div class="card" style="text-align: center; max-width: 500px;">
            <h1><i class="fas fa-futbol"></i> Impostor Futbolero</h1>
            <input type="text" id="playerNameInput" placeholder="Escribe tu nombre..." maxlength="12" autocomplete="off">
            <button id="createRoomBtn"><i class="fas fa-plus"></i> Crear Sala</button>
            <hr style="width: 80%; margin: 20px auto; border-color: var(--border-color);">
            <input type="text" id="roomCodeInput" placeholder="Código de la sala..." maxlength="5" autocomplete="off">
            <button id="joinRoomBtn"><i class="fas fa-sign-in-alt"></i> Unirse a Sala</button>
        </div>
    </div>

    <div id="lobby-screen" class="screen">
        <div class="card">
            <div style="text-align: center;">
                <h2><i class="fas fa-users"></i> Sala de Espera</h2>
                <p style="color: var(--text-secondary);">Comparte este código con tus amigos:</p>
                <div id="roomCodeDisplay"></div>
            </div>
            
            <div class="lobby-container">
                <div id="players-container">
                    <h3><i class="fas fa-user-friends"></i> Jugadores:</h3>
                    <ul id="playerList"></ul>
                </div>
                <div id="chat-container" style="width: 400px; text-align: left;">
                    <h3><i class="fas fa-comments"></i> Chat:</h3>
                    <div id="messages" style="background: var(--bg-main); height: 250px; overflow-y: auto; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--border-color);"></div>
                    <form id="chat-form" style="display: flex; gap: 10px;">
                        <input type="text" id="chat-input" placeholder="Escribe un mensaje..." autocomplete="off" style="margin:0; width: 100%; text-transform: none;">
                        <button type="submit" style="margin:0;"><i class="fas fa-paper-plane"></i></button>
                    </form>
                </div>
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button id="startGameBtn" style="display: none;"><i class="fas fa-play"></i> ¡Empezar Partida!</button>
                <button id="optionsBtn" style="display: none;"><i class="fas fa-cog"></i> Opciones</button>
                <button id="leaveRoomBtn" class="leave-btn"><i class="fas fa-door-open"></i> Salir de la Sala</button>
                <div id="game-options-display" style="margin-top: 15px; color: var(--text-secondary);"></div>
            </div>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div class="card" style="text-align: center;">
            <h2><i class="fas fa-id-badge"></i> Tu rol ha sido asignado:</h2>
            <div id="roleInfo"></div>
            <p style="color: var(--text-secondary); margin-top: 15px;"><i class="fas fa-hourglass-start"></i> La siguiente fase comenzará en breve...</p>
        </div>
    </div>

    <div id="voting-screen" class="screen">
        <div class="card" style="text-align: center;">
            <h2 id="voting-status-title"></h2>
            <div id="timer-container"></div>
            <div id="word-input-container" style="display: none; margin: 20px 0;">
                <form id="word-form" style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                    <input type="text" id="word-input" placeholder="Escribe 1 a 3 palabras..." style="margin: 0;" autocomplete="off">
                    <button type="submit" style="background: var(--color-success);"><i class="fas fa-paper-plane"></i> Enviar</button>
                </form>
            </div>
            <p id="role-info-text"></p>
            <div id="ejection-history" style="margin: 20px auto; padding: 20px; background: var(--bg-main); border-radius: 15px; max-width: 700px; border: 1px solid var(--border-color);">
                <h4><i class="fas fa-clipboard-list"></i> Historial:</h4>
                <div id="ejection-list" style="color: var(--text-primary); font-size: 15px; line-height: 1.6;"></div>
            </div>
            <p id="round-result-text"></p>
            <ul id="voting-list"></ul>
        </div>
    </div>

    <div id="game-over-screen" class="screen">
        <div class="card" style="text-align: center;">
            <h2 id="game-result-title"></h2>
            <p id="ejection-info"></p>
            <div id="impostor-reveal"></div>
            <button id="play-again-btn" style="display: none;"><i class="fas fa-redo"></i> Jugar de Nuevo</button>
        </div>
    </div>

    <div id="options-modal" class="modal-overlay">
        <div class="modal-content">
            <h2><i class="fas fa-cogs"></i> Opciones de Partida</h2>

            <div class="option-group">
                <label>Modo de Juego</label>
                <select id="online-game-mode-select" style="width: 100%;">
                    <option value="playersAndClubs">Jugadores + Clubes</option>
                    <option value="clubsOnly">Solo Clubes</option>
                </select>
            </div>
            
            <div class="option-group">
                <label>Cantidad de Impostores</label>
                <div class="impostor-count-selector" style="display: flex; gap: 10px;">
                </div>
                <small id="player-requirement-notice" style="color: var(--color-warning); display: none; margin-top: 5px;"></small>
            </div>

            <div class="option-group">
                <label>Tiempo de Votación (segundos)</label>
                <div class="voting-time-selector" style="display: flex; gap: 10px;">
                </div>
            </div>

            <hr style="border-color: var(--border-color); margin: 25px 0;">

            <div class="option-group" id="online-clues-option-group">
                <label>Pistas para Impostor</label>
                <label class="switch">
                    <input type="checkbox" id="clues-enabled-checkbox">
                    <span class="slider"></span>
                </label>
            </div>

            <div id="clue-probability-group" class="option-group" style="display:none;">
                <label>Probabilidad de Pista: <span id="probability-value" class="probability-value">5%</span></label>
                <input type="range" id="clue-probability-slider" min="5" max="100" step="5" value="5">
            </div>
            
            <div class="option-group" id="online-confused-option-group">
                <label>Prob. de Falso Jugador: <span id="confused-crewmate-value" class="probability-value">0% (Desactivado)</span></label>
                <input type="range" id="confused-crewmate-slider" min="0" max="5" step="1" value="0">
            </div>

            <div style="text-align: right; margin-top: 30px;">
                <button id="close-options-btn" class="leave-btn">Cancelar</button>
                <button id="save-options-btn">Guardar</button>
            </div>
        </div>
    </div>
    
    <div id="error-modal-container" style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1001;">
        <div class="error-modal"></div>
    </div>
    
    <div id="offline-setup-screen" class="screen">
        <div class="card" style="text-align: center; max-width: 600px;">
            <h2><i class="fas fa-mobile-alt"></i> Modo Presencial</h2>
            
            <div class="option-group">
                <label for="offlinePlayerCount">¿Cuántos jugadores?</label>
                <select id="offlinePlayerCount" style="max-width: 300px; margin: 0 auto;">
                    <option value="3">3 Jugadores</option>
                    <option value="4">4 Jugadores</option>
                    <option value="5">5 Jugadores</option>
                    <option value="6">6 Jugadores</option>
                    <option value="7">7 Jugadores</option>
                    <option value="8">8 Jugadores</option>
                    <option value="9">9 Jugadores</option>
                    <option value="10">10 Jugadores</option>
                </select>
            </div>

            <div id="offline-player-names-container" class="option-group" style="max-width: 400px; margin: 20px auto;">
                </div>

            <hr style="border-color: var(--border-color); margin: 25px 0;">
            <h3>Opciones de Partida</h3>

             <div class="option-group">
                <label>Modo de Juego</label>
                <select id="offline-game-mode-select" style="max-width: 300px; margin: 0 auto;">
                    <option value="playersAndClubs">Jugadores + Clubes</option>
                    <option value="clubsOnly">Solo Clubes</option>
                </select>
            </div>

            <div class="option-group">
                <label>Cantidad de Impostores</label>
                <div id="offline-impostor-count-selector" class="impostor-count-selector" style="display: flex; gap: 10px; justify-content: center;">
                    </div>
                <small id="offline-player-requirement-notice" style="color: var(--color-warning); display: none; margin-top: 5px;"></small>
            </div>
            
            <div class="option-group" id="offline-clues-option-group">
                <label>Pistas para Impostor</label>
                <label class="switch" style="margin: 0 auto;">
                    <input type="checkbox" id="offline-clues-enabled-checkbox">
                    <span class="slider"></span>
                </label>
            </div>

            <div id="offline-clue-probability-group" class="option-group" style="display:none;">
                <label>Probabilidad de Pista: <span id="offline-probability-value" class="probability-value">5%</span></label>
                <input type="range" id="offline-clue-probability-slider" min="5" max="100" step="5" value="5">
            </div>
            
            <div class="option-group" id="offline-confused-option-group">
                <label>Prob. de Falso Jugador: <span id="offline-confused-crewmate-value" class="probability-value">0% (Desactivado)</span></label>
                <input type="range" id="offline-confused-crewmate-slider" min="0" max="5" step="1" value="0">
            </div>


            <hr style="border-color: var(--border-color); margin: 25px 0;">

            <button id="startOfflineGameBtn"><i class="fas fa-play"></i> Iniciar Reparto de Roles</button>
            <button id="backToMenuBtn" class="leave-btn"><i class="fas fa-arrow-left"></i> Volver al Menú</button>
        </div>
    </div>

    <div id="offline-reveal-screen" class="screen">
        <div class="card" style="text-align: center; max-width: 500px;">
            <div id="offline-pass-device">
                <h2>Pásale el dispositivo a <span id="offline-player-name-turn">Jugador 1</span></h2>
                <p style="color: var(--text-secondary);">Cuando estés listo, presiona el botón para ver tu rol.</p>
                <button id="offline-show-role-btn"><i class="fas fa-eye"></i> Ver mi Rol</button>
            </div>
            <div id="offline-role-reveal" style="display: none;">
                <div id="offline-countdown" class="countdown-large">5</div>
                <div id="offline-role-content" style="display: none;">
                    <h2><span id="offline-player-name-reveal"></span>, tu rol es...</h2>
                    <div id="offline-role-info"></div>
                    <button id="offline-hide-role-btn"><i class="fas fa-check"></i> Entendido, pasar al siguiente</button>
                </div>
            </div>
        </div>
    </div>


    <script src="/socket.io/socket.io.js"></script>
    <script src="client.js"></script>

</body>
</html>
